<!--
=============================================================================
HALO - AI-Powered Medical Device Assistant
=============================================================================
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Halo - Medical Device Assistant</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Google Fonts - Distinctive typography -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  
  <style>
    /* =====================================================================
       CSS VARIABLES - Design tokens for consistent theming
       ===================================================================== */
    :root {
      /* Primary colors - Teal/Cyan gradient theme */
      --primary-start: #0d9488;
      --primary-end: #06b6d4;
      --primary-gradient: linear-gradient(135deg, var(--primary-start) 0%, var(--primary-end) 100%);
      
      /* Accent colors */
      --accent-purple: #8b5cf6;
      --accent-pink: #ec4899;
      --accent-amber: #f59e0b;
      
      /* Neutrals */
      --bg-dark: #0f172a;
      --bg-medium: #1e293b;
      --bg-light: #f1f5f9;
      --bg-white: #ffffff;
      
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #94a3b8;
      --text-white: #ffffff;
      
      /* Status colors */
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --info: #3b82f6;
      
      /* Shadows */
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --shadow-glow: 0 0 40px rgba(13, 148, 136, 0.3);
      
      /* Border radius */
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --radius-full: 9999px;
      
      /* Transitions */
      --transition-fast: 150ms ease;
      --transition-normal: 250ms ease;
      --transition-slow: 400ms ease;
    }

    /* =====================================================================
       GLOBAL STYLES
       ===================================================================== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html {
      scroll-behavior: smooth;
    }
    
    body {
      font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
      min-height: 100vh;
      color: var(--text-primary);
      line-height: 1.6;
    }
    
    /* =====================================================================
       HEADER - Halo branding
       ===================================================================== */
    .header {
      background: var(--bg-dark);
      padding: 0;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow-lg);
    }
    
    .header-content {
      max-width: 1100px;
      margin: 0 auto;
      padding: 12px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
    }
    
    .header-nav {
      display: flex;
      gap: 4px;
    }
    
    .header-nav-btn {
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.7);
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
    }
    
    .header-nav-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    .header-nav-btn.active {
      background: rgba(255, 255, 255, 0.15);
      color: white;
    }
    
    .header-nav-primary {
      background: var(--primary-gradient) !important;
      color: white !important;
    }
    
    .header-nav-primary:hover {
      opacity: 0.9;
    }
    
    @media (max-width: 768px) {
      .header-nav {
        display: none;
      }
      
      .header-content {
        padding: 10px 16px;
      }
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo-image {
      height: 48px;
      width: auto;
      object-fit: contain;
    }
    
    .logo-icon {
      width: 44px;
      height: 44px;
      flex-shrink: 0;
    }
    
    .header-logo-img {
      height: 44px;
      width: auto;
      flex-shrink: 0;
    }
    
    .header-pulse {
      width: 40px;
      height: 40px;
      flex-shrink: 0;
    }
    
    .halo-ring {
      width: 100%;
      height: 100%;
      animation: halo-pulse 3s ease-in-out infinite;
    }
    
    @keyframes halo-pulse {
      0%, 100% { opacity: 0.7; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.08); }
    }
    
    .logo-text {
      display: flex;
      flex-direction: column;
    }
    
    .logo-title {
      font-size: 28px;
      font-weight: 700;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.5px;
    }
    
    .logo-subtitle {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1.5px;
      font-weight: 500;
    }
    
    .header-badge {
      background: rgba(16, 185, 129, 0.15);
      color: var(--success);
      padding: 6px 14px;
      border-radius: var(--radius-full);
      font-size: 12px;
      font-weight: 600;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    /* =====================================================================
       MAIN CONTAINER
       ===================================================================== */
    .main-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 24px;
    }
    
    /* Mobile navigation (hidden on desktop since header has nav) */
    .mobile-nav {
      display: none;
      gap: 4px;
      background: var(--bg-white);
      padding: 6px;
      border-radius: var(--radius-lg);
      margin-bottom: 20px;
      box-shadow: var(--shadow-md);
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    @media (max-width: 768px) {
      .mobile-nav {
        display: flex;
      }
    }
    
    .mobile-nav-btn {
      flex: 1;
      min-width: 70px;
      padding: 10px 12px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }
    
    .mobile-nav-btn:hover {
      background: #f1f5f9;
    }
    
    .mobile-nav-btn.active {
      background: var(--primary-gradient);
      color: white;
    }

    /* =====================================================================
       INTRO / WELCOME SECTION
       ===================================================================== */
    .intro-section {
      text-align: center;
      padding: 32px 24px 40px;
      margin-bottom: 24px;
    }
    
    .intro-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .intro-logo {
      height: 64px;
      width: auto;
      object-fit: contain;
    }
    
    .intro-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.3;
      text-align: left;
      margin: 0;
    }
    
    .intro-text {
      font-size: 16px;
      color: var(--text-secondary);
      line-height: 1.7;
      max-width: 600px;
      margin: 0 auto 12px;
    }
    
    .intro-note {
      font-size: 14px;
      color: var(--text-muted);
      margin-top: 16px;
      padding: 12px 16px;
      background: #f8fafc;
      border-radius: var(--radius-md);
      border-left: 3px solid var(--primary-start);
    }

    /* =====================================================================
       CARDS / SECTIONS
       ===================================================================== */
    .card {
      background: var(--bg-white);
      border-radius: var(--radius-lg);
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-md);
      border: 1px solid rgba(0, 0, 0, 0.04);
      transition: box-shadow var(--transition-normal), transform var(--transition-normal);
    }
    
    .card:hover {
      box-shadow: var(--shadow-lg);
    }
    
    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .step-badge {
      background: var(--primary-gradient);
      color: white;
      width: 32px;
      height: 32px;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      flex-shrink: 0;
    }
    
    .card-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* =====================================================================
       IDENTIFICATION MODE TOGGLE
       ===================================================================== */
    .identification-toggle {
      display: flex;
      gap: 0;
      margin-bottom: 20px;
      border-radius: var(--radius-lg);
      overflow: hidden;
      border: 2px solid #e2e8f0;
      background: #f8fafc;
    }
    
    .toggle-btn {
      flex: 1;
      padding: 16px 24px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-normal);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-family: inherit;
    }
    
    .toggle-btn:hover {
      background: #e2e8f0;
    }
    
    .toggle-btn.active {
      background: var(--primary-gradient);
      color: white;
    }
    
    .mode-section {
      padding-top: 8px;
    }
    
    .mode-description {
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: 16px;
      line-height: 1.6;
    }
    
    .direct-select-btn {
      width: 100%;
      padding: 18px 24px;
      background: var(--primary-gradient);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-normal);
      box-shadow: var(--shadow-md);
      font-family: inherit;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .direct-select-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl), var(--shadow-glow);
    }

    /* =====================================================================
       STREAMLINED EXTRACTION RESULTS
       ===================================================================== */
    .inline-select-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    
    .form-group.compact {
      margin-bottom: 0;
    }
    
    .form-group.compact label {
      font-size: 12px;
      margin-bottom: 4px;
    }
    
    .extraction-results {
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      border: 1px solid #86efac;
      border-radius: var(--radius-md);
      padding: 16px;
      margin-top: 16px;
    }
    
    .extraction-header {
      margin-bottom: 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .extraction-title {
      font-weight: 600;
      font-size: 15px;
    }
    
    .extraction-title.status-detected { color: #166534; }
    .extraction-title.status-partial { color: #b45309; }
    .extraction-title.status-not-found { color: #dc2626; }
    
    .extraction-subtitle {
      font-size: 13px;
      color: var(--text-muted);
    }
    
    .detected-device {
      background: white;
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 16px;
    }
    
    .detected-device-name {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 6px;
    }
    
    .detected-separator {
      color: var(--text-muted);
      margin: 0 8px;
    }
    
    .detected-device-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    .detected-field {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: var(--radius-md);
      padding: 12px 14px;
    }
    
    .detected-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }
    
    .detected-value {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 6px;
    }
    
    .detected-conf {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
    }
    
    .conf-label {
      color: var(--text-muted);
    }
    
    .confidence-value {
      font-weight: 700;
      padding: 2px 6px;
      border-radius: 4px;
    }
    
    .confidence-value.high { 
      color: #16a34a; 
      background: #dcfce7;
    }
    .confidence-value.medium { 
      color: #d97706; 
      background: #fef3c7;
    }
    .confidence-value.low { 
      color: #dc2626; 
      background: #fee2e2;
    }
    
    .confirm-edit-buttons {
      display: flex;
      gap: 12px;
    }
    
    .btn-confirm-correct {
      flex: 1;
      padding: 14px 20px;
      background: #16a34a;
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
    }
    
    .btn-confirm-correct:hover {
      background: #15803d;
    }
    
    .btn-edit-device {
      padding: 14px 20px;
      background: white;
      color: var(--text-secondary);
      border: 1px solid #e2e8f0;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
    }
    
    .btn-edit-device:hover {
      background: #f8fafc;
      border-color: var(--text-muted);
    }
    
    .edit-mode {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px dashed #86efac;
    }
    
    .edit-mode-label {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }
    
    .edit-mode-actions {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }
    
    .edit-mode-actions .btn-primary {
      flex: 1;
    }
    
    .edit-mode-actions .btn-secondary {
      padding: 12px 20px;
      background: #f1f5f9;
      border: 1px solid #e2e8f0;
      color: var(--text-secondary);
      border-radius: var(--radius-md);
      font-size: 14px;
      cursor: pointer;
    }
    
    .detected-device-confirmed {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .confirmed-icon {
      width: 36px;
      height: 36px;
      background: #16a34a;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: bold;
    }
    
    .detected-status {
      font-size: 13px;
      color: #16a34a;
      font-weight: 500;
    }
    
    .free-text-compact {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 8px;
    }
    
    .free-text-compact input {
      padding: 10px 12px;
      font-size: 13px;
    }
    
    .low-confidence-warning {
      margin-top: 12px;
      padding: 10px 12px;
      background: #fef3c7;
      border: 1px solid #fcd34d;
      border-radius: var(--radius-sm);
      font-size: 13px;
      color: #92400e;
    }
    
    .device-actions {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }
    
    .btn-start-chat {
      flex: 1;
      padding: 16px 24px;
      font-size: 16px;
    }
    
    .btn-reset {
      padding: 16px 20px;
      background: #f1f5f9;
      border: 1px solid #e2e8f0;
      color: var(--text-secondary);
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
    }
    
    .btn-reset:hover {
      background: #e2e8f0;
    }
    
    @media (max-width: 500px) {
      .extraction-grid, .inline-select-row, .free-text-compact {
        grid-template-columns: 1fr;
      }
    }

    /* =====================================================================
       FORM ELEMENTS
       ===================================================================== */
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-primary);
      font-size: 14px;
    }
    
    input[type="file"] {
      width: 100%;
      padding: 16px;
      border: 2px dashed #cbd5e1;
      border-radius: var(--radius-md);
      cursor: pointer;
      background: #f8fafc;
      transition: all var(--transition-normal);
      font-family: inherit;
    }
    
    input[type="file"]:hover {
      border-color: var(--primary-start);
      background: rgba(13, 148, 136, 0.05);
    }
    
    select, input[type="text"] {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e2e8f0;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-family: inherit;
      transition: all var(--transition-fast);
      background: white;
      color: var(--text-primary);
    }
    
    select:focus, input[type="text"]:focus {
      outline: none;
      border-color: var(--primary-start);
      box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.15);
    }
    
    select:disabled {
      background: #f1f5f9;
      cursor: not-allowed;
      opacity: 0.7;
    }

    /* =====================================================================
       BUTTONS
       ===================================================================== */
    button {
      font-family: inherit;
      cursor: pointer;
      transition: all var(--transition-normal);
    }
    
    .btn-primary {
      background: var(--primary-gradient);
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 600;
      box-shadow: var(--shadow-md);
    }
    
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg), var(--shadow-glow);
    }
    
    .btn-primary:disabled {
      background: #cbd5e1;
      cursor: not-allowed;
      box-shadow: none;
    }
    
    .btn-secondary {
      background: #f1f5f9;
      color: var(--text-secondary);
      border: 2px solid #e2e8f0;
      padding: 12px 20px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 600;
    }
    
    .btn-secondary:hover {
      background: #e2e8f0;
      border-color: #cbd5e1;
    }
    
    #confirmBtn {
      width: 100%;
      background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
      padding: 16px 24px;
      font-size: 16px;
    }
    
    #confirmBtn:hover:not(:disabled) {
      box-shadow: var(--shadow-lg), 0 0 30px rgba(16, 185, 129, 0.3);
    }

    /* =====================================================================
       BANNERS / ALERTS
       ===================================================================== */
    .banner {
      padding: 16px 20px;
      border-radius: var(--radius-md);
      margin-bottom: 20px;
      display: none;
      border-left: 4px solid;
    }
    
    .banner.show {
      display: block;
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .warning-banner {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-color: var(--warning);
      color: #92400e;
    }
    
    .success-banner {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border-color: var(--success);
      color: #065f46;
    }
    
    .error-banner {
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
      border-color: var(--error);
      color: #991b1b;
    }
    
    .banner-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .banner-message {
      font-size: 14px;
      opacity: 0.9;
    }

    /* =====================================================================
       FREE TEXT SECTION
       ===================================================================== */
    .free-text-section {
      display: none;
      padding-top: 16px;
      border-top: 2px dashed #e2e8f0;
      margin-top: 16px;
    }
    
    .free-text-section.show {
      display: block;
    }
    
    .free-text-note {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* =====================================================================
       CHAT SECTION
       ===================================================================== */
    #chat {
      display: none;
    }
    
    #chat.show {
      display: block;
    }
    
    .chat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .chat-header h3 {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 0;
      font-size: 18px;
    }
    
    .halo-avatar {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    
    .halo-avatar svg {
      width: 100%;
      height: 100%;
      animation: halo-pulse 3s ease-in-out infinite;
    }
    
    @keyframes halo-pulse {
      0%, 100% { opacity: 0.8; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.1); }
    }
    
    .clear-chat-btn {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #dc2626;
      padding: 8px 14px;
      font-size: 13px;
      border-radius: var(--radius-md);
      font-weight: 500;
    }
    
    .clear-chat-btn:hover {
      background: #fee2e2;
    }
    
    .chat-history {
      max-height: 500px;
      overflow-y: auto;
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 4px;
    }
    
    .chat-input-container {
      display: flex;
      gap: 12px;
      flex: 1;
      padding: 12px 16px;
      background: #f8fafc;
      border-radius: var(--radius-lg);
      border: 2px solid #e2e8f0;
      transition: border-color var(--transition-fast);
    }
    
    .chat-input-container:focus-within {
      border-color: var(--primary-start);
    }
    
    .chat-input-container input {
      flex: 1;
      border: none;
      background: transparent;
      font-size: 15px;
      padding: 12px;
    }
    
    .chat-input-container input:focus {
      outline: none;
      box-shadow: none;
    }
    
    .chat-input-container button {
      background: var(--primary-gradient);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: var(--radius-md);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* =====================================================================
       CHAT MESSAGES
       ===================================================================== */
    .chat-message {
      padding: 16px 20px;
      border-radius: var(--radius-lg);
      max-width: 90%;
      animation: messageIn 0.3s ease;
    }
    
    @keyframes messageIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .user-message {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border: 1px solid #93c5fd;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }
    
    .assistant-message {
      background: white;
      border: 1px solid #e2e8f0;
      align-self: flex-start;
      border-bottom-left-radius: 4px;
      box-shadow: var(--shadow-sm);
    }
    
    .message-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    
    .message-role {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .user-message .message-role {
      color: #1d4ed8;
    }
    
    .assistant-message .message-role {
      color: var(--primary-start);
    }
    
    .halo-mini-avatar {
      width: 24px;
      height: 24px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .halo-mini-avatar svg {
      width: 100%;
      height: 100%;
      animation: halo-pulse 3s ease-in-out infinite;
    }
    
    .message-content {
      line-height: 1.7;
      color: var(--text-primary);
    }
    
    .message-content p { margin-bottom: 12px; }
    .message-content p:last-child { margin-bottom: 0; }
    .message-content ul, .message-content ol { margin: 12px 0; padding-left: 24px; }
    .message-content li { margin: 6px 0; }
    .message-content strong { font-weight: 600; }
    .message-content code {
      background: #f1f5f9;
      padding: 2px 8px;
      border-radius: 4px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9em;
    }
    .message-content pre {
      background: var(--bg-dark);
      color: #e2e8f0;
      padding: 16px;
      border-radius: var(--radius-md);
      overflow-x: auto;
      margin: 12px 0;
    }
    .message-content pre code {
      background: none;
      padding: 0;
      color: inherit;
    }
    .message-content h1, .message-content h2, .message-content h3 {
      margin: 20px 0 10px 0;
      font-weight: 600;
    }

    /* =====================================================================
       SOURCES DISPLAY
       ===================================================================== */
    .message-sources {
      margin-top: 16px;
      padding: 12px 16px;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: var(--radius-md);
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all var(--transition-fast);
    }
    
    .message-sources:hover {
      background: #f1f5f9;
    }
    
    .sources-toggle {
      color: var(--text-muted);
      font-size: 10px;
      transition: transform var(--transition-fast);
    }
    
    .confidence-badge {
      margin-left: auto;
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      color: #065f46;
      padding: 4px 12px;
      border-radius: var(--radius-full);
      font-size: 12px;
      font-weight: 600;
    }
    
    .message-sources-list {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      transition: all var(--transition-normal);
    }
    
    .message-sources-list.collapsed {
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      margin-top: 0;
    }
    
    .source-item {
      background: white;
      border: 1px solid #e2e8f0;
      border-left: 3px solid var(--primary-start);
      border-radius: var(--radius-sm);
      padding: 14px;
    }
    
    .source-meta {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 12px;
    }
    
    .source-page {
      color: var(--primary-start);
      font-weight: 600;
    }
    
    .source-score {
      color: var(--text-muted);
      background: #f1f5f9;
      padding: 2px 10px;
      border-radius: var(--radius-full);
    }
    
    .source-text {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.6;
      font-family: 'JetBrains Mono', monospace;
      white-space: pre-wrap;
      word-break: break-word;
    }

    /* =====================================================================
       IMAGES DISPLAY
       ===================================================================== */
    .message-images {
      margin-top: 12px;
      padding: 12px 16px;
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border: 1px solid #fbbf24;
      border-radius: var(--radius-md);
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .message-images:hover {
      background: linear-gradient(135deg, #fde68a 0%, #fcd34d 100%);
    }
    
    .images-toggle {
      font-size: 10px;
      color: #92400e;
    }
    
    .message-images-list {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      transition: all var(--transition-normal);
    }
    
    .message-images-list.collapsed {
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      margin-top: 0;
    }
    
    .image-item {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: var(--radius-md);
      padding: 10px;
      text-align: center;
      transition: all var(--transition-fast);
    }
    
    .image-item:hover {
      transform: scale(1.02);
      box-shadow: var(--shadow-lg);
    }
    
    .image-item img {
      max-width: 200px;
      max-height: 150px;
      border-radius: var(--radius-sm);
      cursor: pointer;
    }
    
    .image-page {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    /* =====================================================================
       FALLBACK WARNING
       ===================================================================== */
    .fallback-warning {
      background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
      border: 2px solid var(--warning);
      border-radius: var(--radius-md);
      padding: 18px;
      margin-bottom: 16px;
    }
    
    .fallback-warning-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
    }
    
    .fallback-warning-icon {
      font-size: 28px;
    }
    
    .fallback-warning-title {
      font-weight: 700;
      color: #c2410c;
      font-size: 15px;
    }
    
    .fallback-warning-message {
      color: #9a3412;
      font-size: 14px;
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: var(--radius-sm);
      border-left: 3px solid var(--warning);
    }
    
    .fallback-disclaimer {
      font-size: 13px;
      color: #78350f;
      font-style: italic;
      margin-bottom: 14px;
      padding: 10px;
      background: rgba(251, 191, 36, 0.2);
      border-radius: var(--radius-sm);
    }
    
    .fallback-sources-title {
      font-size: 13px;
      font-weight: 600;
      color: #78350f;
      margin-bottom: 10px;
    }
    
    .fallback-sources-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .fallback-source-link {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      background: white;
      border: 1px solid #fed7aa;
      border-radius: var(--radius-sm);
      text-decoration: none;
      color: var(--info);
      font-size: 13px;
      font-weight: 500;
      transition: all var(--transition-fast);
    }
    
    .fallback-source-link:hover {
      background: #dbeafe;
      border-color: var(--info);
      transform: translateX(4px);
    }
    
    .fallback-source-link::before {
      content: "ðŸ”—";
    }
    
    .fallback-message {
      border: 2px solid var(--warning) !important;
      background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%) !important;
    }
    
    .fallback-badge {
      background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
      color: white;
      padding: 4px 12px;
      border-radius: var(--radius-full);
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* =====================================================================
       MANUAL NOTIFICATION - Shows when device is confirmed
       ===================================================================== */
    .manual-notification {
      padding: 10px 14px;
      border-radius: var(--radius-md);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
    }
    
    .manual-notification.hidden {
      display: none;
    }
    
    .manual-notification.has-manual {
      background: #ecfdf5;
      border: 1px solid #6ee7b7;
      color: #047857;
    }
    
    .manual-notification.no-manual {
      background: #fffbeb;
      border: 1px solid #fcd34d;
      color: #92400e;
    }
    
    .notification-icon {
      font-size: 16px;
      flex-shrink: 0;
    }
    
    .notification-content {
      flex: 1;
    }
    
    .notification-title {
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 4px;
    }
    
    .has-manual .notification-title {
      color: #065f46;
    }
    
    .no-manual .notification-title {
      color: #92400e;
    }
    
    .notification-message {
      font-size: 14px;
      line-height: 1.5;
    }
    
    .has-manual .notification-message {
      color: #047857;
    }
    
    .no-manual .notification-message {
      color: #b45309;
    }
    
    .notification-disclaimer {
      margin-top: 8px;
      font-size: 13px;
      font-style: italic;
      opacity: 0.85;
    }

    /* =====================================================================
       LOADING STATES
       ===================================================================== */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #e2e8f0;
      border-top-color: var(--primary-start);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 8px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading-text {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--text-secondary);
      font-size: 14px;
    }

    /* =====================================================================
       LIGHTBOX
       ===================================================================== */
    .image-lightbox {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(15, 23, 42, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      cursor: pointer;
      backdrop-filter: blur(8px);
    }
    
    .lightbox-content {
      text-align: center;
    }
    
    .lightbox-content img {
      max-width: 90vw;
      max-height: 85vh;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-xl);
    }
    
    .lightbox-close {
      color: white;
      margin-top: 20px;
      font-size: 14px;
      opacity: 0.7;
    }

    /* =====================================================================
       TAB CONTENT
       ===================================================================== */
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Compact intro for Ask Halo tab */
    .compact-intro {
      display: flex;
      align-items: center;
      gap: 24px;
      padding: 24px;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 100%);
      border-radius: var(--radius-lg);
      border: 1px solid #99f6e4;
    }
    
    .compact-intro-logo {
      width: 120px;
      height: 120px;
      object-fit: contain;
      flex-shrink: 0;
    }
    
    .compact-intro-content {
      flex: 1;
    }
    
    .compact-intro-title {
      font-size: 26px;
      font-weight: 700;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 4px;
    }
    
    .compact-intro-subtitle {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }
    
    .compact-intro-text {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.6;
      margin: 0;
    }
    
    .compact-intro-note {
      display: block;
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-muted);
      font-style: italic;
    }
    
    @media (max-width: 600px) {
      .compact-intro {
        flex-direction: column;
        text-align: center;
      }
      
      .compact-intro-logo {
        width: 100px;
        height: 100px;
      }
    }
    
    /* Info page styling */
    .info-page {
      background: var(--bg-white);
      border-radius: var(--radius-lg);
      padding: 32px;
      box-shadow: var(--shadow-md);
    }
    
    .info-page-header {
      display: flex;
      align-items: flex-start;
      gap: 20px;
      margin-bottom: 24px;
    }
    
    .info-page-logo {
      width: 100px;
      height: 100px;
      object-fit: contain;
      flex-shrink: 0;
    }
    
    .info-page-header h2 {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }
    
    .info-page-header p {
      margin: 0;
    }
    
    .info-page-header-reverse {
      flex-direction: row-reverse;
    }
    
    .chat-header-enhanced {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .chat-header-left {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    
    .chat-header-icon {
      width: 72px;
      height: 72px;
      object-fit: contain;
    }
    
    .chat-header-buttons {
      display: flex;
      gap: 10px;
    }
    
    .edit-device-btn {
      background: #f0f9ff;
      border: 1px solid #bae6fd;
      color: #0284c7;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 600;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
    }
    
    .edit-device-btn:hover {
      background: #e0f2fe;
    }
    
    .chat-header-text {
      display: flex;
      flex-direction: column;
    }
    
    .chat-title {
      font-size: 22px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0 0 2px 0;
    }
    
    .chat-subtitle {
      font-size: 13px;
      color: var(--text-muted);
      margin: 0;
    }
    
    .chat-input-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 16px;
    }
    
    .chat-input-pulse {
      width: 32px;
      height: 32px;
      flex-shrink: 0;
    }
    
    .chat-input-pulse .halo-ring {
      width: 100%;
      height: 100%;
    }
    
    .info-page h2 {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .info-page h3 {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 24px 0 12px;
    }
    
    .info-page p {
      color: var(--text-secondary);
      line-height: 1.7;
      margin-bottom: 16px;
    }
    
    .info-page ul {
      list-style: none;
      padding: 0;
    }
    
    .info-page li {
      padding: 12px 16px;
      background: #f8fafc;
      border-radius: var(--radius-sm);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text-secondary);
    }
    
    .info-page li strong {
      color: var(--text-primary);
    }
    
    /* Safety section - condensed cards */
    .safety-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .safety-card {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: var(--radius-md);
      padding: 16px;
      text-align: center;
    }
    
    .safety-icon {
      font-size: 28px;
      margin-bottom: 8px;
    }
    
    .safety-card h4 {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }
    
    .safety-card p {
      font-size: 12px;
      color: var(--text-secondary);
      line-height: 1.5;
      margin: 0;
    }
    
    .safety-disclaimer {
      background: #fef3c7;
      padding: 14px 16px;
      border-radius: var(--radius-md);
      border-left: 4px solid #f59e0b;
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 16px;
    }
    
    /* Device list styling - grouped by manufacturer */
    .device-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }
    
    .manufacturer-group {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: var(--radius-md);
      overflow: hidden;
    }
    
    .manufacturer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 16px;
      cursor: pointer;
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      transition: all var(--transition-fast);
    }
    
    .manufacturer-header:hover {
      background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
    }
    
    .manufacturer-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    
    .manufacturer-name {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .manufacturer-count {
      font-size: 12px;
      color: var(--text-muted);
    }
    
    .manufacturer-toggle {
      font-size: 12px;
      color: var(--text-muted);
      transition: transform var(--transition-fast);
    }
    
    .manufacturer-models {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 8px;
      padding: 12px;
      background: white;
    }
    
    .manufacturer-models.collapsed {
      display: none;
    }
    
    .model-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
      border: 1px solid transparent;
    }
    
    .model-item:hover {
      background: #f0fdfa;
      border-color: var(--primary-start);
    }
    
    .model-item.has-doc {
      background: #f0fdf4;
    }
    
    .model-item.no-doc {
      background: #fafafa;
    }
    
    .model-icon {
      font-size: 14px;
    }
    
    .model-name {
      font-size: 13px;
      color: var(--text-primary);
      font-weight: 500;
    }
    
    /* Feedback form */
    .feedback-form {
      margin-top: 20px;
    }
    
    .feedback-form textarea {
      width: 100%;
      min-height: 120px;
      padding: 14px 16px;
      border: 2px solid #e2e8f0;
      border-radius: var(--radius-md);
      font-family: inherit;
      font-size: 14px;
      resize: vertical;
      transition: all var(--transition-fast);
    }
    
    .feedback-form textarea:focus {
      outline: none;
      border-color: var(--primary-start);
      box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.15);
    }
    
    .feedback-form button {
      margin-top: 12px;
      background: var(--primary-gradient);
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-normal);
    }
    
    .feedback-form button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    
    .feedback-actions {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    
    .feedback-email {
      font-size: 13px;
      color: var(--text-muted);
    }
    
    .feedback-email a {
      color: var(--primary-start);
    }
    
    /* About page - condensed */
    .about-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-top: 20px;
    }
    
    .about-card {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: var(--radius-md);
      padding: 20px 16px;
      text-align: center;
    }
    
    .about-icon {
      font-size: 28px;
      margin-bottom: 10px;
    }
    
    .about-card h4 {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 6px;
    }
    
    .about-card p {
      font-size: 12px;
      color: var(--text-secondary);
      margin: 0;
      line-height: 1.4;
    }
    
    .about-version {
      margin-top: 20px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      color: var(--text-muted);
      text-align: center;
      background: #f1f5f9;
      padding: 10px;
      border-radius: var(--radius-sm);
    }
    
    @media (max-width: 600px) {
      .about-grid {
        grid-template-columns: 1fr;
      }
    }
    
    /* Team members */
    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }
    
    .team-member {
      text-align: center;
      padding: 24px 16px;
      background: #f8fafc;
      border-radius: var(--radius-md);
    }
    
    .team-avatar {
      width: 64px;
      height: 64px;
      background: var(--primary-gradient);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px;
      font-size: 24px;
      color: white;
    }
    
    .team-member h4 {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }
    
    .team-member p {
      font-size: 13px;
      color: var(--text-muted);
      margin: 0;
    }

    /* =====================================================================
       UTILITY CLASSES
       ===================================================================== */
    .hidden {
      display: none !important;
    }
    
    .confidence-display {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
    }
    
    .confidence-low { color: var(--error); }
    .confidence-high { color: var(--success); }
    
    /* =====================================================================
       FOOTER
       ===================================================================== */
    .footer {
      text-align: center;
      padding: 24px;
      color: var(--text-muted);
      font-size: 13px;
    }
    
    .footer a {
      color: var(--primary-start);
      text-decoration: none;
    }
    
    .footer a:hover {
      text-decoration: underline;
    }
  </style>
  
  <!-- Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="/static/script.js" defer></script>
</head>

<body>

<!-- ========================================================================
     HEADER
     ======================================================================== -->
<header class="header">
  <div class="header-content">
    <div class="logo-container" onclick="switchTab('ask-halo')" style="cursor: pointer;">
      <!-- Halo Logo Image -->
      <img src="/static/halo_transparent_zoomed.png" alt="Halo" class="header-logo-img" />
      <div class="logo-text">
        <span class="logo-title">Halo</span>
        <span class="logo-subtitle">Anesthesia Device Assistant</span>
      </div>
    </div>
    <!-- Header Navigation -->
    <nav class="header-nav">
      <button class="header-nav-btn header-nav-primary" onclick="switchTab('ask-halo')" data-tab="ask-halo">ðŸ’¬ Chat with Halo</button>
      <button class="header-nav-btn" onclick="switchTab('devices')" data-tab="devices">Devices</button>
      <button class="header-nav-btn" onclick="switchTab('safety')" data-tab="safety">Safety</button>
      <button class="header-nav-btn" onclick="switchTab('feedback')" data-tab="feedback">Feedback</button>
      <button class="header-nav-btn" onclick="switchTab('about')" data-tab="about">About</button>
    </nav>
    <!-- Pulsating SVG on Right -->
    <div class="header-pulse">
      <svg class="halo-ring" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="24" cy="24" r="20" stroke="url(#haloGradientHeader)" stroke-width="3" fill="none" opacity="0.3"/>
        <circle cx="24" cy="24" r="16" stroke="url(#haloGradientHeader)" stroke-width="4" fill="none"/>
        <circle cx="24" cy="24" r="8" fill="url(#haloGradientHeader)"/>
        <defs>
          <linearGradient id="haloGradientHeader" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#0d9488"/>
            <stop offset="100%" stop-color="#06b6d4"/>
          </linearGradient>
        </defs>
      </svg>
    </div>
  </div>
</header>

<!-- ========================================================================
     MAIN CONTENT
     ======================================================================== -->
<main class="main-container">

  <!-- Mobile Navigation (visible only on small screens) -->
  <nav class="mobile-nav">
    <button class="mobile-nav-btn active" onclick="switchTab('ask-halo')" data-tab="ask-halo">ðŸ’¬ Halo</button>
    <button class="mobile-nav-btn" onclick="switchTab('devices')" data-tab="devices">ðŸ“‹</button>
    <button class="mobile-nav-btn" onclick="switchTab('safety')" data-tab="safety">ðŸ›¡ï¸</button>
    <button class="mobile-nav-btn" onclick="switchTab('feedback')" data-tab="feedback">ðŸ“</button>
    <button class="mobile-nav-btn" onclick="switchTab('about')" data-tab="about">ðŸ‘¥</button>
  </nav>

      <!-- ====================================================================
           TAB: ASK HALO (Default)
           ==================================================================== -->
      <div id="tab-ask-halo" class="tab-content active">
    
    <!-- Compact intro -->
    <div class="compact-intro">
      <img src="/static/halo_meet.png" alt="Halo" class="compact-intro-logo" />
      <div class="compact-intro-content">
        <div class="compact-intro-title">Meet Halo!</div>
        <div class="compact-intro-subtitle">Your Anesthesia Device Assistant</div>
        <p class="compact-intro-text">
          Snap a photo to identify your anesthesia machine, then ask Halo to search user manuals for answers.
          <span class="compact-intro-note">No manual? Halo will search the internet and let you know.</span>
        </p>
      </div>
    </div>

  <!-- UNIFIED DEVICE IDENTIFICATION CARD -->
  <div class="card" id="deviceIdentificationCard">
    <div class="card-header">
      <h3 class="card-title">ðŸ” Identify Your Device</h3>
    </div>
    
    <!-- Mode Toggle -->
    <div class="identification-toggle">
      <button type="button" id="modePhoto" class="toggle-btn active" onclick="setIdentificationMode('photo')">
        ðŸ“¸ Take Photo
      </button>
      <button type="button" id="modeSelect" class="toggle-btn" onclick="setIdentificationMode('select')">
        ðŸ“‹ Select Device
      </button>
    </div>
    
    <!-- Photo Mode -->
    <div id="photoModeSection" class="mode-section">
      <input type="file" id="imageInput" accept="image/*" capture="environment" />
      <div id="extractionLoading" class="loading-text hidden">
        <span class="loading"></span> Analyzing image...
      </div>
    </div>
    
    <!-- Select Mode (inline dropdowns) -->
    <div id="selectModeSection" class="mode-section hidden">
      <div class="inline-select-row">
        <div class="form-group compact">
          <label for="manufacturerSelect">Manufacturer</label>
          <select id="manufacturerSelect">
            <option value="">-- Select --</option>
          </select>
        </div>
        <div class="form-group compact">
          <label for="modelSelect">Model</label>
          <select id="modelSelect" disabled>
            <option value="">-- Select --</option>
          </select>
        </div>
      </div>
    </div>
    
    <!-- INLINE EXTRACTION RESULTS -->
    <div id="extractionResults" class="extraction-results hidden">
      <div class="extraction-header">
        <span class="extraction-title" id="extractionTitle">ðŸŽ¯ Device Detected</span>
        <span class="extraction-subtitle" id="extractionSubtitle"></span>
      </div>
      
      <!-- Detected Device Display -->
      <div class="detected-device" id="detectedDeviceView">
        <div class="detected-device-grid">
          <div class="detected-field">
            <div class="detected-label">Manufacturer</div>
            <div class="detected-value" id="extractedManufacturer">â€”</div>
            <div class="detected-conf">
              <span class="conf-label">Confidence:</span>
              <span id="manuConfidenceText" class="confidence-value">â€”%</span>
            </div>
          </div>
          <div class="detected-field">
            <div class="detected-label">Model</div>
            <div class="detected-value" id="extractedModel">â€”</div>
            <div class="detected-conf">
              <span class="conf-label">Confidence:</span>
              <span id="modelConfidenceText" class="confidence-value">â€”%</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Confirm/Edit Buttons -->
      <div class="confirm-edit-buttons" id="confirmEditButtons">
        <button type="button" class="btn-confirm-correct" onclick="confirmDeviceCorrect()">
          âœ“ This is correct
        </button>
        <button type="button" class="btn-edit-device" onclick="showEditMode()">
          âœï¸ Edit
        </button>
      </div>
      
      <!-- Edit Mode (hidden by default) -->
      <div id="editModeSection" class="edit-mode hidden">
        <p class="edit-mode-label">Select the correct device:</p>
        <div class="inline-select-row">
          <div class="form-group compact">
            <label>Manufacturer</label>
            <select id="editManufacturerSelect">
              <option value="">-- Select --</option>
            </select>
          </div>
          <div class="form-group compact">
            <label>Model</label>
            <select id="editModelSelect" disabled>
              <option value="">-- Select --</option>
            </select>
          </div>
        </div>
        <div id="freeTextSection" class="free-text-compact hidden">
          <input type="text" id="manufacturerInput" placeholder="Manufacturer name..." />
          <input type="text" id="modelInput" placeholder="Model number..." />
        </div>
        <div class="edit-mode-actions">
          <button type="button" class="btn-primary" onclick="confirmEditedDevice()">
            âœ“ Confirm Selection
          </button>
          <button type="button" class="btn-secondary" onclick="cancelEditMode()">
            Cancel
          </button>
        </div>
      </div>
    </div>
    
    <!-- Hidden elements for JS compatibility -->
    <button id="confirmBtn" class="hidden"></button>
    <button id="resetBtn" class="hidden"></button>
  </div>
  
  <!-- Hidden legacy elements for JS compatibility -->
  <div id="warningBanner" class="hidden"></div>
  <div id="partialSuccessBanner" class="hidden"></div>
  <div id="successBanner" class="hidden"></div>
  <div id="noManualBanner" class="banner error-banner hidden">
    <div class="banner-title">No manual available</div>
    <div class="banner-message" id="noManualMessage">The selected device is not in our database.</div>
  </div>
  <div id="deviceSelection" class="hidden"></div>

  <!-- STEP 3: Chat with Halo -->
  <div id="chat" class="card">
    <div class="chat-header-enhanced">
      <div class="chat-header-left">
        <img src="/static/halo_device.png" alt="Halo" class="chat-header-icon" />
        <div class="chat-header-text">
          <h3 class="chat-title">Ask Halo</h3>
          <p class="chat-subtitle" id="chatDeviceInfo">Ask questions about your device</p>
        </div>
      </div>
      <div class="chat-header-buttons">
        <button class="edit-device-btn" onclick="editDeviceFromChat()">âœï¸ Edit</button>
        <button class="clear-chat-btn" onclick="clearChatHistory()">ðŸ—‘ï¸ Clear</button>
      </div>
    </div>
    
    <!-- Manual availability notification -->
    <div id="manualNotification" class="manual-notification hidden">
      <!-- Content populated by JavaScript -->
    </div>
    
    <div id="chatHistory" class="chat-history"></div>
    <div id="answer"></div>
    <div id="sourcesContainer"></div>
    
    <div class="chat-input-wrapper">
      <div class="chat-input-pulse">
        <svg class="halo-ring" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="24" cy="24" r="20" stroke="url(#haloGradChat)" stroke-width="3" fill="none" opacity="0.3"/>
          <circle cx="24" cy="24" r="16" stroke="url(#haloGradChat)" stroke-width="4" fill="none"/>
          <circle cx="24" cy="24" r="8" fill="url(#haloGradChat)"/>
          <defs>
            <linearGradient id="haloGradChat" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#0d9488"/>
              <stop offset="100%" stop-color="#06b6d4"/>
            </linearGradient>
          </defs>
        </svg>
      </div>
      <div class="chat-input-container">
        <input type="text" id="question" placeholder="Ask Halo anything about this device..." 
               onkeypress="if(event.key === 'Enter') ask()" />
        <button onclick="ask()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
          </svg>
          Ask
        </button>
      </div>
    </div>
  </div>

  </div><!-- End tab-ask-halo -->

  <!-- ====================================================================
       TAB: SUPPORTED DEVICES
       ==================================================================== -->
  <div id="tab-devices" class="tab-content">
    <div class="info-page">
      <div class="info-page-header">
        <img src="/static/halo_device_2.png" alt="Devices" class="info-page-logo" />
        <div>
          <h2>Supported Devices</h2>
          <p>Halo currently has official documentation for the following anesthesia machines. For devices not listed, Halo will search publicly available information.</p>
        </div>
      </div>
      
      <div id="deviceList" class="device-grid">
        <!-- Populated by JavaScript -->
        <p class="loading-text">Loading device list...</p>
      </div>
    </div>
  </div>

  <!-- ====================================================================
       TAB: SAFETY
       ==================================================================== -->
  <div id="tab-safety" class="tab-content">
    <div class="info-page">
      <div class="info-page-header">
        <div>
          <h2>Safety & Trust</h2>
          <p>Understanding how Halo provides reliable, transparent information.</p>
        </div>
        <img src="/static/halo_safety.png" alt="Safety" class="info-page-logo" />
      </div>
      
      <div class="safety-grid">
        <div class="safety-card">
          <div class="safety-icon">ðŸ“Š</div>
          <h4>Confidence Scores</h4>
          <p><strong>80%+</strong> High confidence â€¢ <strong>60-80%</strong> Verify recommended â€¢ <strong>&lt;60%</strong> Review source</p>
        </div>
        <div class="safety-card">
          <div class="safety-icon">ðŸ“š</div>
          <h4>Source Types</h4>
          <p><strong>Official Manual</strong> â€” Manufacturer docs with page citations<br><strong>ðŸŒ Internet</strong> â€” Public info, verify independently</p>
        </div>
        <div class="safety-card">
          <div class="safety-icon">ðŸ”’</div>
          <h4>Privacy</h4>
          <p>No patient data stored. Images processed temporarily. Chat history in browser only.</p>
        </div>
      </div>
      
      <p class="safety-disclaimer">
        âš ï¸ <strong>Halo is an assistive tool, not a replacement for professional training.</strong> Always follow your institution's protocols. For critical decisions, consult official manuals or contact the manufacturer.
      </p>
    </div>
  </div>

  <!-- ====================================================================
       TAB: FEEDBACK
       ==================================================================== -->
  <div id="tab-feedback" class="tab-content">
    <div class="info-page">
      <div class="info-page-header">
        <img src="/static/halo_feedback.png" alt="Feedback" class="info-page-logo" />
        <div>
          <h2>Share Your Feedback</h2>
          <p>Help us improve Halo! Report incorrect answers, suggest new devices, or share feature ideas.</p>
        </div>
      </div>
      
      <div class="feedback-form">
        <textarea id="feedbackText" placeholder="ðŸŽ¯ Incorrect answer? ðŸ“š Missing device? ðŸ’¡ Feature idea? ðŸ› Bug report? Let us know..."></textarea>
        <div class="feedback-actions">
          <button onclick="submitFeedback()">Submit Feedback</button>
          <span class="feedback-email">or email <a href="mailto:feedback@halo-ai.example.com">feedback@halo-ai.example.com</a></span>
        </div>
      </div>
    </div>
  </div>

  <!-- ====================================================================
       TAB: ABOUT US
       ==================================================================== -->
  <div id="tab-about" class="tab-content">
    <div class="info-page">
      <div class="info-page-header">
        <img src="/static/halo_about.png" alt="About Halo" class="info-page-logo" />
        <div>
          <h2>About Halo</h2>
          <p>Helping anesthesiologists quickly find information in device manuals, so they can focus on patient care.</p>
        </div>
      </div>
      
      <div class="about-grid">
        <div class="about-card">
          <div class="about-icon">ðŸŽ¯</div>
          <h4>Mission</h4>
          <p>Make complex device manuals instantly searchable with AI.</p>
        </div>
        <div class="about-card">
          <div class="about-icon">ðŸ¤–</div>
          <h4>Technology</h4>
          <p>GPT-4o-mini â€¢ RAG â€¢ LlamaIndex</p>
        </div>
        <div class="about-card">
          <div class="about-icon">ðŸ‘¥</div>
          <h4>Team</h4>
          <p>Built with â¤ï¸ for healthcare professionals</p>
        </div>
      </div>
      
      <p class="about-version">Halo v1.0.0 â€¢ December 2025</p>
    </div>
  </div>

</main>

<footer class="footer">
  <p>Powered by <strong>Halo AI</strong> </p>
</footer>

</body>
</html>

